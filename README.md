<p align="center">
<img src="https://cdn.rawgit.com/realitix/vulkan/182062bc/logo/cvulkan-180x180.png" />
</p>

# Vulkan

> The ultimate Python binding for Vulkan API

## Presentation

*vulkan* is a Python extension which supports the Vulkan API. It leverages power of Vulkan with simplicity of Python.
It's a complete Vulkan wrapper, it keeps the original Vulkan API and try to limit differences induced by Python.

*vulkan* is compatible with Python 2 and Python 3.

## How to install

### Pip

You can install directly *vulkan* with pip:

```
pip install vulkan
```

### Manual install

You can install it manually if you want the latest version:

```
git clone https://github.com/realitix/vulkan
cd vulkan
python setup.py install
```


## How to use

### Getting started

To try this wrapper, execute the following commands (on linux):

```bash
git clone https://github.com/realitix/vulkan.git
cd vulkan
python setup.py install
pip install pysdl2
python example/example.py
```

Known errors :

`OSError: cannot load library 'libvulkan.so'` means you didn't install the [Vulkan SDK](https://vulkan.lunarg.com/).

`vulkan.VkErrorExtensionNotPresent` means your have installed the Vulkan SDK but your driver doesn't support it.


### API

The *vulkan* wrapper gives you complete access to the Vulkan API, including extension functions.


### Code convention

Similar to Vulkan, structs are prefixed with Vk, enumeration values are prefixed with VK_
and functions are prefixed with vk. However, struct creation is done through functions.
If you want to create the struct `VkInstanceCreateInfo`, you must call the function
`VkInstanceCreateInfo` with named parameters.


#### Structs

All structs must be initialized with keyword parameters. Here's an example.
To create the Vulkan struct `VkInstanceCreateInfo`, in **C++** we write:

```C
VkInstanceCreateInfo instance_create_info = {
    VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO, // sType
    nullptr, // pNext
    0, // flags
    &application_info, // *pApplicationInfo
    3, // enabledLayerCount
    &layers, // *ppEnabledLayerNames
    3, // enabledExtensionCount
    &extensions // *ppEnabledExtensionNames
};
```

Here, our *vulkan* wrapper equivalent of the above **C++** code is :

```python
import vulkan as vk

instance_create_info = vk.VkInstanceCreateInfo(
    sType=vk.VK_STRUCTURE_TYPE_INSTANCE_CREATE_INFO,
    pNext=None,
    flags=0,
    pApplicationInfo=application_info,
    enabledLayerCount=len(layers),
    ppEnabledLayerNames=layers,
    enabledExtensionCount=len(extensions),
    ppEnabledExtensionNames=extensions,
)
```

Like you can see, to create the struct, you must pass all parameters at creation time.
I provide Python `list` for `ppEnabledLayerNames` and `ppEnabledExtensionNames`,
indeed, the wrapper converts everything for us into native C types.

*Note:*

- Default value is `None` for all parameters so you could have omitted `pNext` (because its value is `None`).
- Order of parameters doesn't matter since they are keyword parameters.
- The **C++** counterpart is more risky because you must pass all parameters in specific order.

#### Functions

*vulkan* will help you a lot when calling function. In Vulkan API, there are three
kinds of function:

  - functions that create nothing
  - functions that create one object
  - functions that create several objects

*vulkan* takes care of you and knows when it has to return `None`, an object
or a `list`. Here an exemple:

```python
# Create one object
instance = vk.vkCreateInstance(pCreateInfo=createInfo)

# Create a list of object
extensions = vk.vkEnumerateDeviceExtensionProperties(
    physicalDevice=physical_device,
    pLayerName=None)

# Return None
vk.vkQueuePresentKHR(presentation_queue, present_create)
```

Vulkan functions usually return a `VkResult`. *vulkan* is pythonic and
converts it to exception: if the result is not `VK_SUCCESS`, an exception is
raised.

#### Exceptions

Exceptions extends `VkError` or `VkException`. When you look at Vulkan API
documentation, functions can return either an error code or a success code.
Success code is not always `VK_SUCCESS`, it can be `VK_NOT_READY` for example.
Error codes extend `VkError`, success codes extend `VkException`.
Exception names are *pythonized*: `VK_NOT_READY` -> `VkNotReady`.

#### Constants

All Vulkan constants are available in *vulkan* and it provides some fancy
constants like `UINT64_MAX`.


### Ressources

To understand how to use this wrapper, you must look into `example/example.py` or
refer to [Vulk](https://github.com/realitix/vulk) engine.


## How to contribute

To contribute, you should first read the `Architecture` section.
Any contribution is welcome and I answer quickly.


## Architecture

*vulkan* is a CFFI module generated by a Python script.

When you install this module, you need two files:

- `_cffi_build/vulkan.cdef.h` containing CFFI definitions
- `vulkan/__init__.py` containing the actual executed Python script

Theses two files are generated by the `generator/generate.py` script.

`_cffi_build/vulkan.cdef.h` is generated with a `cpp` command call, it applies pre-processing to the Vulkan C header.
It can't work as is because of `pycparser` which cannot parse the output. That's the purpose of `fake_libc_include` folder.

`vulkan/__init__.py` needs more work.
To proceed, the generator computes a model of Vulkan API based on `vk.xml`
(the file from Kronos describing the API) and then uses a `jinja2` template
to write the file.

Here the basic steps:

 - Load vk.xml
 - Use `xmltodict` to parse the xml document
 - Generate a good data model from it
 - Pass the model to the `vulkan.template.py` file
 - The template engine generate the final Python file

## Community

You can checkout my blog, I speak about *vulkan*:
[Blog](https://realitix.github.io)

## Stay in touch

You can contact me by opening issue (bug or interesting discussion about
the project). If you want a fast and pleasant talk, join the irc channel:
`##vulkan` (I'm realitix). I'm connected from 9AM to 6PM (France).

## History

This module comes from a long journey. I have first created [CVulkan](https://github.com/realitix/cvulkan).
*CVulkan* is a wrapper created in plain C, plain C is hard to maintain... So I have decided to restart with
CFFI which is from far the **best** way to do it. There was a module [pyVulkan](https://github.com/bglgwyng/pyVulkan)
that did what I wanted to do. But it was not working and the code was hard to maintain. I asked to the maintainer
to let me [help him](https://github.com/bglgwyng/pyVulkan/issues/12) but I got no answer.
I forked his project and I rewrote every single part to obtain a good module.

## Supported By

*vulkan* is supported by helpful 3rd parties via code contributions, test devices and so forth.
Make our supporters happy and visit their sites!

![linagora](https://www.linagora.com/sites/all/themes/tux/logo.png)
